<p id="notice"><%= notice %></p>
<div id='dish-id' data-id='<%= @dish.id %>'></div>

<p>
  <strong>Name:</strong>
  <%= @dish.name %>
</p>
<p>
  <strong>Restaurant:</strong>
  <%= link_to @dish.restaurant.name, restaurant_path(@dish.restaurant) %>
</p>

  <%= image_tag @dish.image_url, class:'image-url' %>

<p>
  <strong>Price:</strong>
  <%= @dish.price %>Ä‘
</p>

<div class='row'>
  <% if @dish.votes.present?%>
    <% @dishvote = @dish.rounding(@dish.dish_vote) %>
    <%= render 'dishvote'%>
  <% end %>
</div>


<div class='row'>
  <% if @dish.votes.where(user_id: @current_user.id).present? %> 
    <%= render 'myrating'%>
  <% else %>
    <%= render 'rating'%>
  <% end %>
</div>



<div class="card-footer">
  <%= button_to 'Add to Cart', line_items_path(:dish_id => @dish), remote: :true %>
</div>
<div>
  <% if @current_user.id == @dish.user_id%>
    <%= link_to 'Edit', edit_dish_path(@dish) %> |
  <% end %>
</div>
<div>
  <%= link_to 'Back', dishes_path %>
</div>


<script>
  var form = document.getElementById('rating');
  form.addEventListener('submit', event => {
    var formData = new FormData(event.target);
    var rating = formData.get('rating');
    var dishId = $('#dish-id').data('id');
    $.post(`/dishes/${dishId}/vote`, { rate: rating }, function(data) {
      console.log(rating);
    } )
    event.preventDefault();
  });
</script>