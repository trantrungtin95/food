<p id="notice"><%= notice %></p>

<h1>Restaurants</h1>
<hr/>
<% if @restaurants.present?%>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>User</th>
      <th>Address</th>
      <th>Open time</th>
      <th>Close time</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @restaurants.each do |restaurant| %>
      <tr>
        <td><strong><%= link_to restaurant.name, restaurant_path(restaurant) %></strong></td>
        <td><strong><%= link_to restaurant.user.name, user_path(restaurant.user) %></strong></td>
        <td><strong><%= restaurant.address %></strong></td>
        <td><strong><%= restaurant.open_time.strftime("%I:%M %p") %></strong></td>
        <td><strong><%= restaurant.close_time.strftime("%I:%M %p") %></strong></td>
        <% if @current_user.id == restaurant.user_id%>
          <td><%= link_to 'Edit', edit_restaurant_path(restaurant) %></td>
          <td><%= link_to 'Destroy', restaurant, method: :delete, data: { confirm: 'Are you sure?' } %></td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>
<% end %>

<br>
<p><%= will_paginate @restaurants %></p>

<div id='demo'></div>
<div class="row">
  <div style='width: 400px; padding-left: 350px;'>  
    <div id="map" style='width: 800px; height: 600px;'>
    </div>  
  </div>  
  </div>


<script>


var x = document.getElementById("demo");
function getLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPosition);
  } else {
    x.innerHTML = "Geolocation is not supported by this browser.";
  }
}

function showPosition(position) {
  window.latitude = position.coords.latitude,
  window.longitude = position.coords.longitude,
  x.innerHTML = "Latitude: " + position.coords.latitude +
  "<br>Longitude: " + position.coords.longitude;
  
  $.get(`/restaurants/near_by`, { latitude: window.latitude, longitude: window.longitude }, function(data) {
        window.restaurants = data
        console.log(window.restaurants);
    } );

  // $.get({
  //   url: `/restaurants/near_by.json?latitude=${window.latitude}&longitude=${window.longitude}`,
  //   success: function(restaurants) {
  //     window.restaurants = restaurants
  //     console.log(window.restaurants);
  //   }
  // })
} 

function initMap() {
    var lat = window.latitude
    var lng = window.longitude
    // The location of Uluru
    var uluru = {lat, lng};
    // The map, centered at Uluru
    var map = new google.maps.Map(document.getElementById('map'), {zoom: 11, center: uluru});
    // The marker, positioned at Uluru
    var marker = new google.maps.Marker({position: uluru, map: map});
    // var resloca = {10.7700962, 106.6621104}
    $.each(window.restaurants, function(a,restaurant) {
    var resmarker = new google.maps.Marker({
      position: {
        lat: restaurant.latitude, 
        lng: restaurant.longitude
        }, 
      label: restaurant.name, 
      map: map
      });
    })
  }

</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCzs2ja1HKuzIFiccxeB-SFpqOg9WMUk3g&callback=initMap"
type="text/javascript"></script>
